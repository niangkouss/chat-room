<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Title</title>
	<link rel="stylesheet" href="/bootstrap/dist/css/bootstrap.css">
	<!--服务端返回页面,无跨域,要去配置服务端的静态文件根目录-->
</head>
<body>
<style>
	.user{
		color: blue;
		cursor: pointer;
	}
</style>
<div class="container">
	<div class="row">
		<div class="col-md-10 col-md-offset-1">
			<div class="panel panel-success">
				<div class="panel-heading">
					<h3 class="text-center">欢迎来到聊天室</h3>
				</div>
				<div class="panel-body">
					<ul class="list-group" onclick="handleClick(event)"></ul>
				</div>
				<div class="panel-footer">
					<form action="" onsubmit="handleSubmit(event)">
						<div class="form-group">
							<label for="content"></label>
							<input type="text" class="form-control" id="content">
						</div>
						<div class="form-group">
							<button type="submit" class="btn btn-primary">发言</button>
						</div>
					</form>
				</div>
			</div>
		</div>
	</div>
</div>
<script src="/socket.io/socket.io.js"></script> <!--路径为固定写法,此文件是服务端运行后生成的-->
<script>
	let socket = io(); //io对象为引入socket.io.js后获得的,参数不写,或者写/等同于http://localhost:8080,服务器的路径
	socket.on("connect",function () {
		console.log("连接成功");
	});
	socket.on("disconnect",function () {
		console.log("断开连接");
	});
	socket.on("message",function (msgObj) { //监听服务端发送过来的消息
		let msgUl = document.querySelector(".list-group");
		let li = document.createElement("li");
		li.innerHTML = `<span class="user">${msgObj.username}</span>:${msgObj.content}
			<span class="pull-right">${msgObj.createAt}</span>`;
		li.className = "list-group-item";
		msgUl.appendChild(li);
	});

	function handleSubmit(event) {
		event.preventDefault();//阻止默认提交行为
		let contentInput = document.querySelector("#content");
		let val = contentInput.value;
		socket.send(val);
		contentInput.value = "";
	}
	function handleClick(event) { //事件委托,避免多个绑定,提高效率
		if(event.target.className == "user"){
			let username = event.target.innerText;
			let contentInput = document.querySelector("#content");
			contentInput.value = `@${username} `;
		}
	}
</script>
</body>
</html>